<template>
  <div class="bg-gray-900 flex w-full p-8 rounded items-center" @click="connect(tag)">
    <p class="city text-small text-ellipsis overflow-hidden flex-1">{{ city }}</p>
    <div class="flex justify-end gap-8">
      <p class="location-text text-tiny">{{ tag }}</p>
      <Flag :small="true" :country="country"/>
    </div>
  </div>
</template>
<script>
import Flag from "@/components/icons/Flag.vue";
import {useCurrentServerStore} from "@/stores/currentServer";

export default {
  components: {Flag},
  props: {
    country: {
      type: String,
      required: true
    },
    city: {
      type: String,
      required: true
    },
    id: {
      type: Number,
      required: true
    }
  },
  computed: {
    /** Adds 0 to id*/
    tag() {
      if (this.id <= 99) {
        if (this.id <= 9) return this.country.toUpperCase() + "_00" + this.id
        else return this.country.toUpperCase() + "_0" + this.id
      }else {
        return this.country.toUpperCase() + "_" + this.id
      }
    }
  },
  methods: {
    connect(confTag) {
      window.api.startVPN(confTag).then(() =>
          this.currentServer.$patch({
                connected: true,
                serverTag: confTag,
                country: this.country,
                city: this.city
              },
          ))
    }
  },
  setup() {
    const currentServer = useCurrentServerStore();
    return {
      currentServer
    }
  }
}
</script>

<style scoped>
.city {
  line-clamp: 1;
  overflow: hidden;
  white-space: nowrap;
}
</style>